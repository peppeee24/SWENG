<div class="auth-container">
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="logo">
        <h1>üìù NOTA BENE</h1>
        <p class="tagline">Le tue note, condivise e organizzate</p>
      </div>
      <nav class="nav-buttons">
        <button 
          class="nav-btn" 
          [class.active]="!isLoginMode()"
          (click)="switchMode()"
          type="button">
          {{ isLoginMode() ? 'Registrati' : 'Accedi' }}
        </button>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <div class="auth-card" [class.expanded]="!isLoginMode()">
      <!-- Card Header -->
      <div class="card-header">
        <h2>{{ isLoginMode() ? 'Accedi a NOTA BENE' : 'Crea il tuo account' }}</h2>
        <p class="card-subtitle">
          {{ isLoginMode() ? 'Benvenuto! Accedi per gestire le tue note.' : 'Compila i campi per creare il tuo account personale (solo Username e Password sono obbligatori)' }}
        </p>
      </div>

      <!-- Messaggio Successo -->
      @if (successMessage()) {
        <div class="message success-message">
          <div class="message-content">
            <span class="icon">‚úÖ</span>
            {{ successMessage() }}
          </div>
        </div>
      }

      <!-- Messaggio Errore -->
      @if (errorMessage()) {
        <div class="message error-message">
          <div class="message-content">
            <span class="icon">‚ùå</span>
            {{ errorMessage() }}
          </div>
        </div>
      }

      <!-- Login Form -->
      @if (isLoginMode()) {
        <form [formGroup]="loginForm" (ngSubmit)="onLogin()" class="auth-form">
          <div class="form-group">
            <label for="loginUsername">Username</label>
            <input
              id="loginUsername"
              type="text"
              formControlName="username"
              class="form-input"
              [class.error]="loginUsername?.invalid && loginUsername?.touched"
              placeholder="Inserisci il tuo username">
            @if (loginUsername?.invalid && loginUsername?.touched) {
              <div class="field-error">
                @if (loginUsername?.errors?.['required']) {
                  <span>Username √® obbligatorio</span>
                }
                @if (loginUsername?.errors?.['minlength']) {
                  <span>Username deve avere almeno 3 caratteri</span>
                }
              </div>
            }
          </div>

          <div class="form-group">
            <label for="loginPassword">Password</label>
            <input
              id="loginPassword"
              type="password"
              formControlName="password"
              class="form-input"
              [class.error]="loginPassword?.invalid && loginPassword?.touched"
              placeholder="Inserisci la tua password">
            @if (loginPassword?.invalid && loginPassword?.touched) {
              <div class="field-error">
                @if (loginPassword?.errors?.['required']) {
                  <span>Password √® obbligatoria</span>
                }
                @if (loginPassword?.errors?.['minlength']) {
                  <span>Password deve avere almeno 6 caratteri</span>
                }
              </div>
            }
          </div>

          <button 
            type="submit" 
            class="submit-btn" 
            [disabled]="isLoading() || loginForm.invalid">
            @if (!isLoading()) {
              <span>üîê Accedi</span>
            }
            @if (isLoading()) {
              <span class="loading">‚è≥ Accesso in corso...</span>
            }
          </button>
        </form>
      }

      <!-- Form Registrazione -->
      @if (!isLoginMode()) {
        <form [formGroup]="registerForm" (ngSubmit)="onRegister()" class="auth-form register-form">
          
          <!-- Sezione Dati di Accesso -->
          <div class="form-section">
            <h3 class="section-title">üîê Dati di Accesso</h3>
            
            <div class="form-row">
              <div class="form-group">
                <label for="registerUsername">Username *</label>
                <div class="input-container">
                  <input
                    id="registerUsername"
                    type="text"
                    formControlName="username"
                    class="form-input"
                    [class.error]="(registerUsername?.invalid && registerUsername?.touched) || usernameAvailable() === false"
                    [class.success]="usernameAvailable() === true"
                    placeholder="Scegli un username unico">
                  
                  <!-- Indicatori validazione username -->
                  <div class="input-feedback">
                    @if (usernameChecking()) {
                      <span class="spinner">üîÑ</span>
                    }
                    @if (usernameAvailable() === true) {
                      <span class="text-success">‚úÖ</span>
                    }
                    @if (usernameAvailable() === false) {
                      <span class="text-danger">‚ùå</span>
                    }
                  </div>
                </div>
                
                @if (registerUsername?.invalid && registerUsername?.touched) {
                  <div class="field-error">
                    @if (registerUsername?.errors?.['required']) {
                      <span>Username √® obbligatorio</span>
                    }
                    @if (registerUsername?.errors?.['minlength']) {
                      <span>Username deve avere almeno 3 caratteri</span>
                    }
                    @if (registerUsername?.errors?.['maxlength']) {
                      <span>Username deve essere massimo 50 caratteri</span>
                    }
                  </div>
                }
                @if (usernameAvailable() === false) {
                  <div class="field-error">
                    <span>Username gi√† in uso</span>
                  </div>
                }
                @if (usernameAvailable() === true) {
                  <div class="field-success">
                    <span>Username disponibile</span>
                  </div>
                }
              </div>

              <div class="form-group">
                <label for="registerEmail">Email (opzionale)</label>
                <div class="input-container">
                  <input
                    id="registerEmail"
                    type="email"
                    formControlName="email"
                    class="form-input"
                    [class.error]="(registerEmail?.invalid && registerEmail?.touched) || emailAvailable() === false"
                    [class.success]="emailAvailable() === true && registerEmail?.value"
                    placeholder="nome@esempio.com">
                  
                  <!-- Indicatori validazione email -->
                  <div class="input-feedback">
                    @if (emailChecking()) {
                      <span class="spinner">üîÑ</span>
                    }
                    @if (emailAvailable() === true && registerEmail?.value) {
                      <span class="text-success">‚úÖ</span>
                    }
                    @if (emailAvailable() === false) {
                      <span class="text-danger">‚ùå</span>
                    }
                  </div>
                </div>
                
                @if (registerEmail?.invalid && registerEmail?.touched) {
                  <div class="field-error">
                    @if (registerEmail?.errors?.['email']) {
                      <span>Inserisci un'email valida</span>
                    }
                    @if (registerEmail?.errors?.['maxlength']) {
                      <span>Email deve essere massimo 150 caratteri</span>
                    }
                  </div>
                }
                @if (emailAvailable() === false) {
                  <div class="field-error">
                    <span>Email gi√† in uso</span>
                  </div>
                }
                @if (emailAvailable() === true && registerEmail?.value) {
                  <div class="field-success">
                    <span>Email disponibile</span>
                  </div>
                }
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="registerPassword">Password *</label>
                <input
                  id="registerPassword"
                  type="password"
                  formControlName="password"
                  class="form-input"
                  [class.error]="registerPassword?.invalid && registerPassword?.touched"
                  placeholder="Almeno 6 caratteri">
                @if (registerPassword?.invalid && registerPassword?.touched) {
                  <div class="field-error">
                    @if (registerPassword?.errors?.['required']) {
                      <span>Password √® obbligatoria</span>
                    }
                    @if (registerPassword?.errors?.['minlength']) {
                      <span>Password deve avere almeno 6 caratteri</span>
                    }
                  </div>
                }
              </div>

              <div class="form-group">
                <label for="confirmPassword">Conferma Password *</label>
                <input
                  id="confirmPassword"
                  type="password"
                  formControlName="confirmPassword"
                  class="form-input"
                  [class.error]="(registerConfirmPassword?.invalid && registerConfirmPassword?.touched) || registerForm.errors?.['passwordMismatch']"
                  placeholder="Ripeti la password">
                @if (registerConfirmPassword?.invalid && registerConfirmPassword?.touched) {
                  <div class="field-error">
                    @if (registerConfirmPassword?.errors?.['required']) {
                      <span>Conferma password √® obbligatoria</span>
                    }
                  </div>
                }
                @if (registerForm.errors?.['passwordMismatch'] && registerConfirmPassword?.touched) {
                  <div class="field-error">
                    <span>Le password non corrispondono</span>
                  </div>
                }
              </div>
            </div>
          </div>

          <!-- Sezione Dati Personali -->
          <div class="form-section">
            <h3 class="section-title">üë§ Dati Personali <em>(opzionali)</em></h3>
            
            <div class="form-row">
              <div class="form-group">
                <label for="registerNome">Nome</label>
                <input
                  id="registerNome"
                  type="text"
                  formControlName="nome"
                  class="form-input"
                  [class.error]="registerNome?.invalid && registerNome?.touched"
                  placeholder="Il tuo nome">
                @if (registerNome?.invalid && registerNome?.touched) {
                  <div class="field-error">
                    @if (registerNome?.errors?.['maxlength']) {
                      <span>Nome deve essere massimo 100 caratteri</span>
                    }
                  </div>
                }
              </div>

              <div class="form-group">
                <label for="registerCognome">Cognome</label>
                <input
                  id="registerCognome"
                  type="text"
                  formControlName="cognome"
                  class="form-input"
                  [class.error]="registerCognome?.invalid && registerCognome?.touched"
                  placeholder="Il tuo cognome">
                @if (registerCognome?.invalid && registerCognome?.touched) {
                  <div class="field-error">
                    @if (registerCognome?.errors?.['maxlength']) {
                      <span>Cognome deve essere massimo 100 caratteri</span>
                    }
                  </div>
                }
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="registerSesso">Sesso</label>
                <select
                  id="registerSesso"
                  formControlName="sesso"
                  class="form-input form-select">
                  <option value="">Seleziona sesso</option>
                  <option value="M">Maschio</option>
                  <option value="F">Femmina</option>
                  <option value="ALTRO">Altro</option>
                </select>
              </div>

              <div class="form-group">
                <label for="registerDataNascita">Data di Nascita</label>
                <input
                  id="registerDataNascita"
                  type="date"
                  formControlName="dataNascita"
                  class="form-input">
              </div>
            </div>
          </div>

          <!-- Sezione Contatti -->
          <div class="form-section">
            <h3 class="section-title">üìû Informazioni di Contatto <em>(opzionali)</em></h3>
            
            <div class="form-row">
              <div class="form-group">
                <label for="registerTelefono">Numero di Telefono</label>
                <input
                  id="registerTelefono"
                  type="tel"
                  formControlName="telefono"
                  class="form-input"
                  [class.error]="registerTelefono?.invalid && registerTelefono?.touched"
                  placeholder="+39 123 456 7890">
                @if (registerTelefono?.invalid && registerTelefono?.touched) {
                  <div class="field-error">
                    @if (registerTelefono?.errors?.['pattern']) {
                      <span>Inserisci un numero di telefono valido</span>
                    }
                  </div>
                }
              </div>

              <div class="form-group">
                <label for="registerCitta">Citt√†</label>
                <input
                  id="registerCitta"
                  type="text"
                  formControlName="citta"
                  class="form-input"
                  [class.error]="registerCitta?.invalid && registerCitta?.touched"
                  placeholder="La tua citt√†">
                @if (registerCitta?.invalid && registerCitta?.touched) {
                  <div class="field-error">
                    @if (registerCitta?.errors?.['maxlength']) {
                      <span>Citt√† deve essere massimo 100 caratteri</span>
                    }
                  </div>
                }
              </div>
            </div>
          </div>

          <!-- Sezione Privacy -->
          <div class="form-section">
            <h3 class="section-title">üìã Termini e Privacy</h3>
            
            <div class="checkbox-group">
              <div class="checkbox-item">
                <input
                  id="accettaTermini"
                  type="checkbox"
                  formControlName="accettaTermini"
                  class="form-checkbox">
                <label for="accettaTermini" class="checkbox-label">
                  Accetto i <a href="#" class="link">Termini e Condizioni</a> *
                </label>
                @if (registerAccettaTermini?.invalid && registerAccettaTermini?.touched) {
                  <div class="field-error">
                    <span>Devi accettare i Termini e Condizioni</span>
                  </div>
                }
              </div>

              <div class="checkbox-item">
                <input
                  id="accettaPrivacy"
                  type="checkbox"
                  formControlName="accettaPrivacy"
                  class="form-checkbox">
                <label for="accettaPrivacy" class="checkbox-label">
                  Accetto l'<a href="#" class="link">Informativa sulla Privacy</a> *
                </label>
                @if (registerAccettaPrivacy?.invalid && registerAccettaPrivacy?.touched) {
                  <div class="field-error">
                    <span>Devi accettare l'Informativa sulla Privacy</span>
                  </div>
                }
              </div>
            </div>
          </div>

          <button 
            type="submit" 
            class="submit-btn" 
            [disabled]="isLoading() || usernameAvailable() === false || emailAvailable() === false">
            @if (!isLoading()) {
              <span>‚ú® Crea Account</span>
            }
            @if (isLoading()) {
              <span class="loading">‚è≥ Creazione account in corso...</span>
            }
          </button>
        </form>
      }

      <!-- Switch Mode -->
      <div class="card-footer">
        <p>
          {{ isLoginMode() ? 'Non hai un account?' : 'Hai gi√† un account?' }}
          <button class="link-btn" (click)="switchMode()" type="button">
            {{ isLoginMode() ? 'Registrati qui' : 'Accedi qui' }}
          </button>
        </p>
      </div>
    </div>

    <!-- Features Section (solo in modalit√† login) -->
    @if (isLoginMode()) {
      <div class="features-section">
        <h3>üåü Perch√© scegliere NOTA BENE?</h3>
        <div class="features-grid">
          <div class="feature-card">
            <div class="feature-icon">üìù</div>
            <h4>Note Veloci</h4>
            <p>Crea note di massimo 280 caratteri, perfette per idee rapide</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">üë•</div>
            <h4>Condivisione</h4>
            <p>Condividi le tue note con permessi di lettura o scrittura</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">üè∑Ô∏è</div>
            <h4>Organizzazione</h4>
            <p>Organizza con tag e cartelle per ritrovare tutto facilmente</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">üîÑ</div>
            <h4>Versionamento</h4>
            <p>Traccia ogni modifica e ripristina versioni precedenti</p>
          </div>
        </div>
      </div>
    }
  </main>
</div>